<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/reset.css" type="text/css">
    <link rel="stylesheet" href="./css/style.css" type="text/css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="./js/main.js"></script>
    <title>oFig - La référence des figurines FF</title>
</head>

<body>

    <header class="main-header">
        <h1 class="main-header__title">
            oFig <span class="main-header__subtitle">Figurines et statuettes</span>
        </h1>
        <h2 class="main-header__secondary-title">
            Votre panier contient <em><span id="nbr-product">2 </span><span id="product"> produit</span></em>
        </h2>
    </header>

    <main class="main-content">
        <div class="soldes-tag">Soldes</div>
        <form action="" class="delivery">
            <section class="basket">
                <header class="basket__header">
                    <h3>
                        Votre panier
                    </h3>
                </header>
                <div class="basket__content">
                    <table class="table">
                        <thead class="table__heading">
                            <tr>
                                <td>Figurine</td>
                                <td>Prix unitaire</td>
                                <td>Quantité</td>
                            </tr>
                        </thead>
                        <tbody class="table__body">
                            <tr class="table__row">
                                <td>Cloud Stife</td>
                                <td><span id="price-cloud">59</span>€</td>
                                <td>
                                    <input type="number" name="" id="quantity-cloud" class="quantity-input">
                                    <button type="button" class="table__delete-button"
                                        id="delete-quantity-cloud">supprimer</button>
                                </td>
                            </tr>
                            <tr class="table__row">
                                <td>Tifa Lockhart</td>
                                <td><span id="price-tifa">69</span>€</td>
                                <td> <input type="number" class="quantity-input" name="" id="quantity-tifa">
                                    <button type="button" class="table__delete-button"
                                        id="delete-quantity-tifa">supprimer</button></td>
                            </tr>
                            <tr class="table__row">
                                <td>Barret Wallace</td>
                                <td><span id="price-barret">69</span>€</td>
                                <td> <input type="number" class="quantity-input" name="" id="quantity-barret">
                                    <button type="button" class="table__delete-button"
                                        id="delete-quantity-barret">supprimer</button></td>
                            </tr>
                        </tbody>
                        <tfoot class="table__footer">
                            <tr>
                                <td colspan="2" class="total__content">Total de la commande :</td>
                                <td class="total__number"><span class="total-nbr-table">197</span>€</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </section>
            <hr>
            <section class="delivery">
                <header class="delivery__header">
                    <h3>
                        Préférence de livraison
                    </h3>
                </header>
                <div class="delivery-wrapper">
                    <div class="delivery__choice">
                        <fieldset>
                            <legend>Où souhaitez vous êtes livré ?</legend>
                            <div class="form-row">
                                <input type="radio" name="address-choice" value="my-address" id="" checked>
                                <label for="my-address">Mon adresse courante</label>
                            </div>
                            <input type="radio" name="address-choice" value="other-address" id="">
                            <label for="other-address">Autre adresse</label>
                        </fieldset>
                        <fieldset>
                            <legend>Options</legend>
                            <div class="form-row">
                                <input id="follow-up" type="checkbox" name="follow-up" checked>
                                <label for="follow-up">Suivi de livraison par sms (inclus)</label>
                            </div>
                            <div class="form-row">
                                <input id="refund" type="checkbox" name="refund">
                                <label for="refund">Satisfait ou remboursé (+ 2 euros)</label>
                            </div>
                            <div class="form-row">
                                <input id="garantee" type="checkbox" name="garantee">
                                <label for="garantee">Garantie 2 ans (+ 10 euros)</label>
                            </div>
                        </fieldset>
                    </div>
                    <div class="address-form">
                        <fieldset>
                            <legend>Adresse</legend>
                            <div class="form-row">
                                <label for="street" class="address-form__label">Rue</label>
                            </div>
                            <div class="form-row">
                                <input type="text" name="street" id="" class="address-form__field">
                            </div>
                            <div class="form-row">
                                <label class="address-form__label" for="street">Code postal</label>
                            </div>
                            <div class="form-row">
                                <input type="number" name="cp" id="" class="address-form__field">
                            </div>
                            <div class="form-row">
                                <label class="address-form__label" for="street">Ville</label>
                            </div>
                            <div class="form-row">
                                <input type="text" name="city" id="" class="address-form__field">
                            </div>
                        </fieldset>
                        <fieldset>
                            <legend>Informations complémentaires</legend>
                            <label for="infos">interphone,bâtiment, etc.</label>
                            <textarea class="address-form__field address-form__field--area" name="infos" id="" cols="30"
                                rows="3"></textarea>
                        </fieldset>
                    </div>
                </div>
            </section>
            <hr>
            <section class="total-confirmation">
                <div class="total__content">Montant total à régler : </div>
                <div class="total__number"><span class="total-nbr-final">196</span>€</div>
            </section>
            <hr>
            <section class="ctas">
                <button type="button" class="ctas-button ctas-button--secondary">Continuer vos achats</button>
                <button class="ctas-button ctas-button--primary">Valider et payer</button>
            </section>
        </form>
        <hr>
    </main>

    <footer class="main-footer">
        <p class="main-footer_content">
            oFig - toutes les images sont sous copyright SquareEnix
        </p>
    </footer>


    <script>
        /* Get all quantity price */
        let priceCloud = parseInt(document.getElementById("price-cloud").innerHTML);
        let priceTifa = parseInt(document.getElementById("price-tifa").innerHTML);
        let priceBarret = parseInt(document.getElementById("price-barret").innerHTML);

        /* Init quantity to 0 */

        let fieldCloud = document.querySelector("#quantity-cloud");
        let fieldTifa = document.querySelector("#quantity-tifa");
        let fieldBarret = document.querySelector("#quantity-barret");

        fieldCloud.value = 0
        fieldTifa.value = 0
        fieldBarret.value = 0

        let quantityCloud = !isNaN(fieldCloud) ? parseInt(fieldCloud.value) : 0;
        let quantityTifa = !isNaN(fieldTifa) ? parseInt(fieldTifa.value) : 0;
        let quantityBarret = !isNaN(fieldBarret) ? parseInt(fieldBarret.value) : 0;

        /* Init Quantity in header to 0 */
        let totalQuantitySpan = document.querySelector("#nbr-product")
        totalQuantitySpan.innerHTML = 0


        /* Init total price to 0 */
        let totalPriceTable = document.querySelector(".total-nbr-table")
        let totalPriceFinal = document.querySelector(".total-nbr-final")
        totalPriceTable.innerHTML = 0
        totalPriceFinal.innerHTML = 0


        // Update Quantity on change Field in form

        let newTotalCost = () => {
            quantityCloud = parseInt(fieldCloud.value);
            quantityTifa = parseInt(fieldTifa.value);
            quantityBarret = parseInt(fieldBarret.value);
            return (quantityCloud * priceCloud) + (quantityTifa * priceTifa) + (quantityBarret *
                priceBarret)
        }

        let editQuantity = () => {
            quantityCloud = parseInt(fieldCloud.value);
            quantityTifa = parseInt(fieldTifa.value);
            quantityBarret = parseInt(fieldBarret.value);
            let globalQuantity = quantityCloud + quantityTifa + quantityBarret;
            console.log(globalQuantity)
            totalQuantitySpan.innerHTML = globalQuantity;
            globalQuantity > 1 ? document.querySelector("#product").innerHTML = " produits" : document
                .querySelector("#product").innerHTML = " produit"
        }

        /* Adapt plural if quantity > 1 */

        document.querySelector("form").addEventListener('change', (event) => {





            /* Update quantity & plural in header */
            editQuantity();


            /* Handle Options */
            if (document.querySelector("#refund").checked === true) {
                newTotalCost = newTotalCost + 2
            }
            if (document.querySelector("#garantee").checked === true) {
                newTotalCost = newTotalCost + 10
            }


            /* Update Total Cost Value */
            totalPriceTable.innerHTML = newTotalCost();
            totalPriceFinal.innerHTML = newTotalCost();
        })

        /*         Reset Quantity */
        document.querySelector("#delete-quantity-cloud").addEventListener('click', (event) => {
            document.querySelector("#quantity-cloud").value = 0
            totalPriceTable.innerHTML = newTotalCost();
            totalPriceFinal.innerHTML = newTotalCost();
            editQuantity();
        })
        document.querySelector("#delete-quantity-tifa").addEventListener('click', (event) => {
            document.querySelector("#quantity-tifa").value = 0
            totalPriceTable.innerHTML = newTotalCost();
            totalPriceFinal.innerHTML = newTotalCost();
            editQuantity();
        })
        document.querySelector("#delete-quantity-barret").addEventListener('click', (event) => {
            document.querySelector("#quantity-barret").value = 0
            totalPriceTable.innerHTML = newTotalCost();
            totalPriceFinal.innerHTML = newTotalCost();
            editQuantity();
        })
    </script>

</body>

</html>